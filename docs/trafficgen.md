# Traffic Generators

The `compose.sh` script generated by [netdef-compose](../netdef-compose/README.md) command integrates a number of subcommands that prints traffic flow information or runs traffic generators.
They can be invoked in a Compose context directory (e.g. `~/compose/20230601`), after the UEs have been registered and the PDU sessions have been established.

## Gather netif counters

`./compose.sh linkstat` command prints a table or writes a TSV document that lists network interface counters.
The information is gathered by executing `ip -s link show` in each container.
If a container lacks the iproute2 package, it is silently skipped.

By default, the output is an aligned textual table.
You can set `--out=FILENAME` flag to write to a TSV output file.
You can set `--out=-.tsv` flag to print the TSV document to the console.

The table shows network interfaces within each container (across all hosts, in case of a multi-host deployment).
Each row has container name, network interface name, RX packet counter, and TX packet counter.
By default, the table only includes the networks defined in the Compose file.
You can specify `--net=PATTERN` flag with a minimatch pattern to change which network interfaces are included; for example, `--net=n[369]` selects n3, n6, and n9 interfaces.
To show all network interfaces (including "lo" and PDU sessions), use `--net=ALL` flag.

Each packet counter is an accumulative value since the network interface was added.
Typically, you should run this command once before starting traffic generators, and again after stopping traffic generators, and then calculate the difference between the two counter readings on the same network interface.
Depending on the scenario topology and traffic flows you executed, it may be possible to determine whether the traffic flows were sent over the expected network interfaces, and whether packet loss has occurred either within a network function or on the network links between two network functions.

## List PDU sessions

`./compose.sh list-pdu` command prints a table or writes a TSV document that lists all established PDU sessions.
You can choose an output format with the `--out` flag, same as the `linkstat` subcommand section.

The information is gathered by executing `ip addr show` in each UE container, and then matching the interface IP addresses against UE subnets defined for Data Networks.
Any network interface that has an IP address within one of the UE subnets is considered a PDU session and included in the output.

If a UE container runs multiple UEs (other than UERANSIM), the report would be imprecise because this command cannot identify which UE owns each IP address.
For UERANSIM, the `nr-cli ps-list` command output is also taken into consideration to distinguish which UE owns each IP address.

## nmap

`./compose.sh nmap` performs nmap ping scans from Data Network to determine how many UEs are reachable.
`--dnn` flag, specified as a [minimatch](https://www.npmjs.com/package/minimatch) pattern, selects which Data Network(s) to scan.
The scanned subnet size for each Data Network is adjusted to cover all online UEs.
`--cmdout` flag saves the commands to a file instead of executing.

```bash
# scan all Data Networks
./compose.sh nmap

# scan specific Data Networks
./compose.sh nmap --dnn='internet'

# print commands instead of executing
./compose.sh nmap --cmdout=-.sh

# save commands to file instead of executing
./compose.sh nmap --cmdout=nmap.sh
```

## Client-Server Traffic Generators

See [client-server traffic generators](tgcs.md) for how to use iperf3, OWAMP, etc.

## Named Data Networking

See [Named Data Networking in user plane](NDN.md).
