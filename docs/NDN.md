# Named Data Networking in User Plane

The `compose.sh` script generated by [netdef-compose](../netdef-compose/README.md) command integrates a number of subcommands that enabled Named Data Networking (NDN) functionality in the user plane.
After launching NFD, NDN traffic generators may be used through traffic flow flags of `./compose.sh tgcs` command, as introduced in [client-server traffic generators](tgcs.md).

## NDN Forwarding Daemon (NFD)

`./compose.sh nfd` launches NFD within a Data Network.
NFD containers are attached to every UE with a PDU session on the specified Data Network, as well as the DN container itself.

```bash
# start NFDs in UEs and DN
./compose.sh nfd --dnn=DNN

# start NFDs in UEs only
./compose.sh nfd --dnn=DNN --server=IP
```

Each "client" NFD in UE containers has a "permanent" UDP face and a default route pointed to the "server" NFD in the DN.
If `--server` flag is omitted, a "server" NFD is launched in the DN container netns; if `--server` flag is specified, it is assumed that a "server" NFD exists in the DN at the specified IP address.

You can only launch one NFD instance attached to each UE container.
One reason is that, NFD does not support creating a unicast UDP face with a specific local IP address.
Therefore, an IP route for the "server" address must be inserted, and there can be only one such route.

## ndnping

`--ndnping` traffic flow flag prepares NDN reachability test using [ndnping and ndnpingserver](https://github.com/named-data/ndn-tools/tree/master/tools/ping).

```bash
./compose.sh tgcs --ndnping='DNN | * | -c 4 | -s 1000'
./tg.sh
```

NFD must have been launched in the chosen DNN.
ndnping and ndnpingserver will connect to local NFD via Unix socket.
Each DNN can have only one ndnpingserver instance.
If multiple traffic flow flags match the DNN, the server flags are taken from the last traffic flow flag.

The `--prefix` flag passed to tgcs command is used as the NDN name prefix.
Port numbers assigned by tgcs command are ignored.

When launching NFD, if the `--server` flag was used to specify an alternate "server" NFD, the ndnpingserver started by the traffic generator script will not receive Interests.
Instead, you must manually start an ndnpingserver attached to the "server" NFD for the proper name prefix.

## NDN-DPDK as UPF

See [NDN-DPDK](../ndndpdk/README.md) for how to select and launch NDN-DPDK as UPF.

To use ndnping traffic generator with NDN-DPDK UPF, you must create a UDP face in NDN-DPDK forwarder pointing to the "service" NFD in the DN container and add a route on this face.
The `--ip-fixed` flag of netdef-compose command may be useful to ensure stable IP address assignments on N6 interfaces of NDN-UPF and DN containers, so that you can have a stable face locator for this face.
