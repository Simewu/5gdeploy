# Named Data Networking in User Plane

The `compose.sh` script generated by [netdef-compose](../netdef-compose/README.md) command integrates a number of subcommands that enabled Named Data Networking (NDN) functionality in the user plane.

## NDN Forwarding Daemon (NFD)

`./compose.sh nfd` launches NFD within a Data Network.
NFD containers are attached to every UE with a PDU session on the specified Data Network, as well as the DN container itself.

```bash
# start NFDs in UEs and DN
./compose.sh nfd --dnn=DNN

# start NFDs in UEs only
./compose.sh nfd --dnn=DNN --server=IP
```

Each "client" NFD in UE containers have a "permanent" UDP face and a default route pointed to the "server" NFD in the DN.
If `--server` flag is omitted, a "server" NFD is launched in the DN container netns; if `--server` flag is specified, it is assumed that a "server" NFD exists in the DN at the specified IP address.

You can only launch one NFD instance attached to each UE container, because:

* NFD does not support creating a unicast UDP face with a specific local IP address.
  An IP route for the "server" address must be inserted, and there can be only one such route.
* NFD listens on tcp:6363 for application connections.
  Having multiple NFD instances would cause a port conflict.

## ndnping

`--ndnping` flag of `./compose.sh tgcs` command prepares NDN reachability test using [ndnping and ndnpingserver](https://github.com/named-data/ndn-tools/tree/master/tools/ping).

```bash
./compose.sh tgcs --ndnping='dnn | * | -c 4 | -s 1000'
./tg.sh
```

The command line syntax follows [client-server traffic generators](trafficgen.md).
It accepts the `--prefix` flag, not only as the prefix for container names, but also as the NDN name prefix.
In the `--ndnping` flags, you must specify a DNN in which NFD instances have been launched.
ndnping and ndnpingserver will connect to local NFD on tcp:6363; port numbers in the TSV output are ignored.

When launching NFD, if the `--server` flag was used to specify an alternate "server" NFD, the ndnpingserver started by the traffic generator script will not receive Interests.
Instead, you must manually start an ndnpingserver attached to the "server" NFD for the proper name prefix.
